---
layout: post
title:  "Terraced Terrain Generator development report"
date:   2022/10/08 12:10:12 +0200
author: Matheus Amazonas
categories: jekyll update
---
# Step 1: Basic shape generation

This step is responsible for generating the polygon that will server as a basic shape for the terrain. In order words, how the terrain will look like from a high up, top view. 

## Supported shapes

- Equilateral triangle.
- Any regular (equilateral and equiangular) polygon, from 4 to 10 sides.

## Equilateral triangle

Generating an equilateral triangle is trivial: create 3 vertices equally distant from the center of the terrain. Each pair forms a 60Â° angle with the center.

![{{ site.post_images }}/post15/Triangle.svg]({{ site.post_images }}/post15/Triangle.svg)
{:align="center"}

## Any regular polygon

All other regular polygons (independent of the number of sides) will be generated using the same strategy. We take advantage of the fact that regular polygons can be created by composing triangles and define all polygon generation based on it. Regular polygons are perfect for this task because their vertices are equidistant from the polygon's center.

<aside>
ðŸ’¡ Although it is possible to generate polygons with any number of sides using this strategy, the number of sides is limited to 10.
</aside>

### Square

A square can be created by overlapping 2 isosceles, right-angled triangles on their hypotenuses. The triangles are created in a similar manner to the equilateral triangles described above, but vertices are recycled to save memory. A square contains 4 vertices and 2 triangles.

![{{ site.post_images }}/post15/Square1.svg]({{ site.post_images }}/post15/Square1.svg){:width="25%"}
{:align="center"}

### Pentagon

A pentagon can also be created using triangles, but differently from the strategies described above. A vertex is placed on the center of the pentagon and it's used by all triangles that compose the polygon. All other vertices are equidistant from the center vertex. Once again, vertices are recycled to save memory.

![{{ site.post_images }}/post15/Pentagon.svg]({{ site.post_images }}/post15/Pentagon.svg){:width="30%"}
{:align="center"}

### Other regular polygons

Other regular polygons with more than 5 sides are created using the same strategy as the pentagon's, just increasing the number of vertices. For example, here's a decagon:

![{{ site.post_images }}/post15/new_decagon.png]({{ site.post_images }}/post15/new_decagon.png){:width="40%"}
{:align="center"}

# Step 2: Mesh fragmentation

The basic shape generated by the previous step does not contain enough vertices and triangles to generate a nice terrain. We need to fragment it into smaller triangles to increase its detail and resolution. 

We start by taking advantage that all shapes generated in the previous steps are composed by triangles. Then, we can fragment these triangles into smaller ones. Breaking down a triangle into smaller triangles is trivial: divide it into 4 triangles like the image below. The outer, bigger triangle is the original one and the smaller, inner triangles are the outcome of a triangle fragmentation.

![{{ site.post_images }}/post15/Triangle_fragmentation.svg]({{ site.post_images }}/post15/Triangle_fragmentation.svg){:width="40%"}
{:align="center"}

The fragmentation can continue recursively, on the generated triangles. If we fragment the 4 triangles above, we would obtain the following 16 triangles.

![{{ site.post_images }}/post15/Triangle_fragmentation-2_iterations.svg]({{ site.post_images }}/post15/Triangle_fragmentation-2_iterations.svg){:width="40%"}
{:align="center"}

The more fragmentation iterations we perform, the higher is the resolution of the final mesh. We can say a mesh was fragmented with a depth D of there were performed D fragmentation iterations on it. The resulting mesh will contain $T * 4^D$ triangles, where T is the number of triangles in the original mesh and D is the fragmentation depth.

Here's an example of a triangle that has been fragmented 6 times (depth = 6):

![{{ site.post_images }}/post15/new_triangle_6.png]({{ site.post_images }}/post15/new_triangle_6.png)
{:align="center"}

Here's a pentagon that has been fragmented 5 times (depth = 5):

![{{ site.post_images }}/post15/pentagon.png]({{ site.post_images }}/post15/pentagon.png)
{:align="center"}